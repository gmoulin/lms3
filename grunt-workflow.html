---
layout: default
title: Grunt workflow
---
<div class="intro">
	<p>

	</p>
</div>

<!-- Workflow -->
<div class="doc-section">
	<div class="page-header">
		<h1 id="workflow">Workflow:</h1>
	</div>

	<h3 id="livereload">Livereload</h3>
	<p>
		<ol>
			<li>watch css (not sass), frontend javascript, images, view templates and html files</li>
			<li>watch sass files (compiled to css with sourcemap)</li>
			<li>watch backend javascript for node server restart</li>
		</ol>
	</p>

	<h3 id="development">Development</h3>
	<p>
		<ol>
			<li>clean generated folders and files or previous builds</li>
			<li>compile sass into css</li>
			<li>remove unused css</li>
			<li>precompile partial html templates to js</li>
			<li>check js and css files for errors using linters</li>
			<li>run automated tests</li>
			<li>run tests coverage</li>
			<li>update included stylesheets in layout</li>
			<li>update included scripts in layout</li>
		</ol>
	</p>
</div>
<!--/Workflow -->

<!-- Tasks -->
<div class="doc-section">
	<div class="page-header">
		<h1 id="tasks">Tasks:</h1>
	</div>

	<h3 id="linters">Linters</h3>
	<p>
		Plugins: <a href="https://github.com/gruntjs/grunt-contrib-jshint" target="_blank">grunt-contrib-jshint</a> and <a href="https://github.com/gruntjs/grunt-contrib-csslint" target="_blank">grunt-contrib-csslint</a>.<br />
		Checking syntax and errors while enforcing some rules help maintaining a sane source base across versions.<br />
		In my editor I use jslint to validate javascript syntax, using jshint in the workflow give me access to other syntax rules.<br />
		Csslint is used for css checking, as the stylesheets will be compiled from sass code, it is a quick solution to check if anything has broken.<br />
	</p>

	<h3 id="node-debug-help">Node debug help</h3>
	<p>
		Plugin: <a href="https://github.com/ChrisWren/grunt-node-inspector" target="_blank">grunt-node-inspector</a>
		Help me debug server side code in the browser.<br />
	</p>

	<h3 id="automated-tests">Automated tests</h3>
	<p>
		Framework: <a href="http://visionmedia.github.io/mocha/" target="_blank">mocha</a>.<br />
		Plugins: <br />
		<ul>
			<li><a href="https://github.com/pghalliday/grunt-mocha-test" target="_blank">grunt-mocha-test</a> for server side with coverage</li>
			<li><a href="https://github.com/ModelN/grunt-blanket-mocha" target="_blank">grunt-blanket-mocha</a> for client side with coverage and build failure if minimum coverage thresholds are not met (see <a href="http://geekdave.com/2013/08/02/automated-code-coverage-enforcement-for-mocha-using-grunt-and-blanket/" target="_blank">this post</a>) using an headless browser</li>
			<li><a href="https://github.com/stu-salsbury/grunt-blanket-mocha-server" target="_blank">grunt-blanket-mocha-server</a></li>
			<li><a href="https://github.com/karma-runner/grunt-karma" target="_blank">grunt-karma</a>, run tests in real browsers</li>
			<li><a href="https://github.com/karma-runner/karma-coverage" target="_blank">karma-coverage</a> to get code coverage of karma tests</li>
			<li><a href="https://github.com/karma-runner/karma-mocha" target="_blank">karma-mocha</a> to run mocha tests in karma runner</li>
		</ul>
		<br />
		Automated tests are mandatory to avoid regressions and bugs between versions.<br />
		I wanted to be able to test the client and server side code with the same framework (mocha), get code coverage and have a way to run the tests in real browsers.<br />
		I will need to test everything and certainly loose some hairs in the process.
	</p>

	<h3 id="managing-scripts-and-stylesheets">Managing scripts and stylesheets</h3>
	<p>
		Plugin: <a href="https://github.com/jwvdiermen/grunt-include-source" target="_blank">grunt-include-source</a>.<br />
		Splitting code between several files is important for any javascript app, but the inclusion of all this files in the layout can quickly become a maintenance nightmare, grunt can automate this task.<br />
		I tryed and search for a grunt plugin able to add script or stylesheets into an html file at a specific place.<br />
		Also I needed it to be compatible with a grunt minification plugin.<br />
		Order can be managed in the html code.<br />
	</p>

	<h3 id="update-html-with-minified-files">Update html with minified files</h3>
	<p>
		Plugin: <a href="https://github.com/yeoman/grunt-usemin" target="_blank">grunt-usemin</a>.<br />
		For quality and production environments I wanted to simply update the scripts and stylesheets references with concatened and minified one.<br />
		Generaly you have to already get the scripts and stylesheets references in the html for usemin to work, but since I am using <a href="https://github.com/jwvdiermen/grunt-include-source" target="_blank">grunt-include-source</a> the references will be added automaticaly.<br />
		For this trick to work grunt-include-source must run before useminPrepare, also in the html, usemin comments must surround include-source ones.<br />
		{% highlight html %}
<!-- build:js js/app.js -->
<!-- include: "type": "js", "files": "public/scripts/**/*.js" -->
<!-- references generated by include-source -->
&lt;script src="js/app.js"&gt;&lt;/script&gt;
&lt;script src="js/controllers/xyz-controller.js"&gt;&lt;/script&gt;
&lt;script src="js/models/xyz-model.js"&gt;&lt;/script&gt;
&lt;script src="js/views/xyz-view.js"&gt;&lt;/script&gt;
<!-- endbuild -->
		{% endhighlight %}
	</p>

	<h3 id="managing-generated-files-and-folders">Managing generated files and folders</h3>
	<p>
		Plugin: <a href="https://github.com/gruntjs/grunt-contrib-clean" target="_blank">grunt-contrib-clean</a>
		Simple cleaning task to always get an up to date build.<br />
	</p>

	<h3 id="cleaning-bower-dependencies">Cleaning bower dependencies</h3>
	<p>
		Plugin: <a href="https://github.com/KidkArolis/grunt-bower-clean" target="_blank">grunt-bower-clean</a>.<br />
		Simply remove unused files from bower components.<br />
	</p>

	<h3 id="managing-file-change">Managing file change</h3>
	<p>
		Plugins: <a href="https://github.com/gruntjs/grunt-contrib-watch" target="_blank">grunt-contrib-watch</a> and <a href="https://github.com/ChrisWren/grunt-nodemon" target="_blank">grunt-nodemon</a>.<br />
		Use "livereload" feature by watching css (not sass), frontend javascript, images, view templates and html files, linked with browser plugin to fire page refresh.<br />
		Also restart node server on backend javascript files modification.<br />
		The sass files are watched for auto compilation but the "livereload" will occurs only on css files.
	</p>

	<h3 id="concurrent-tasks">Concurrent tasks</h3>
	<p>
		Plugin: <a href="https://github.com/sindresorhus/grunt-concurrent" target="_blank">grunt-concurrent</a>.<br />
		Run the "livereload" tasks concurrently (nodemon, node-inspector and watch).
	</p>

	<h3 id="precompile-templates-and-partials">Precompile templates and partials</h3>
	<p>
		Plugin: <a href="https://github.com/karlgoldstein/grunt-html2js" target="_blank">grunt-html2js</a>.<br />
		Since I want an offline first approach angular must have all the templates ready for use.
	</p>

	<h3 id="compile-sass">Compile Sass</h3>
	<p>
		Plugin: <a href="https://github.com/gruntjs/grunt-contrib-sass" target="_blank">grunt-contrib-sass</a>.<br />
		Compile the sass files into css one, also generating the sourcemap for Chrome inspector direct modification of sass file (usefull when tweaking UI).<br />
		Use a "watch" task for automated compilation on changes.
	</p>

	<h3 id="compile-sass">Dry CSS</h3>
	<p>
		Plugin: <a href="https://github.com/addyosmani/grunt-uncss" target="_blank">grunt-uncss</a>.<br />
		Remove unused stylesheets rules, for example taking a multi-page project using Bootstrap with >120KB of CSS down to 11KB.<br />
	</p>
</div>
<!--/Tasks -->
